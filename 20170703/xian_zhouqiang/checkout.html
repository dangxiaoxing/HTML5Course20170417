
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">
        html,body {
            height: 100%;
        }
        #addUserAddress {
            cursor: pointer;
        }
        #addUserAddress:hover {
            background: black;
            color: white;
        }
        .address-item {
            border: 1px solid coral;
            cursor: pointer;
        }
        .address-item:hover {
            background: black;
            color: white;
        }
        .layer {
            display: none;
            background: rgba(0, 0, 0, 0.8);
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
        }
        .dialog {
            width: 600px;
            height: 500px;
            margin: 10px auto;
            border: 1px solid gray;
            text-align: center;
            background: white;
        }
        .dialog h2 {
            line-height: 30px;
            text-align: left;
            border-bottom: 1px solid gray;
        }
        .dialog h2 span {
            display: inline-block;
            float: right;
            padding: 0px 10px;
            background: orange;
            cursor: pointer;
        }

        .normal {
            border: 1px solid gray;
            padding: 2px 5px;
            text-align: center;
            cursor: pointer;
        }
        .normal:hover {
            background: black;
            color: white;
        }
        .selected {
            border: 1px solid red;
        }
    </style>
</head>
<body>
<h1>结算页面</h1>
<div id="address"></div>
<span id="addUserAddress">新增收货人信息</span>
<span id="total">总计：</span>
<span id="order">下订单</span>

<div class="layer">
    <div class="dialog">
        <h2>新增收货人信息<span>x</span></h2>
        <form>
            收货人名称：<input type="text" name="address_name" value="周强"><br />
            <!-- 名称：<input type="text" name="consignee" value="2"><br /> -->
            <!-- 名称：<input type="text" name="country" value="3"><br /> -->
            省：<input type="text" name="province" value="陕西"><br />
            市：<input type="text" name="city" value="西安"><br />
            区：<input type="text" name="district" value="碑林"><br />
            地址：<input type="text" name="address" value="***"><br />
            <!-- 邮编：<input type="text" name="zip_code" value="7"><br /> -->
            手机号：<input type="text" name="mobile" value="1234572839"><br />
             邮箱：<input type="text" name="email" value="9"><br />
            <input type="button" id="add" name="" value="添加收货地址">
        </form>
    </div>
</div>
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js" charset="utf-8"></script>
<script src="scripts/common.js" type="text/javascript"></script>
<script type="text/javascript">
    //得到总价，显示在当前页面
    var total = $.getQueryString('total');
    $('#total').text('总计：'+total);
    var address_id = 0;
    //给地址栏加上一个点击事件
    $('#address').click(function(event){
        console.log(event.target);
        if (event.target) {
            address_id = event.target.getAttribute('data-id');
        }
    });

    $(function(){

        //点击下订单
        //提交一个ajax请求，真实的下一个订单
        //下完订单之后跳转到订单列表页面
        $('#order').click(function(){
            if (address_id === 0) {
                alert('请选择地址后再下订单');
                return;
            }
            shop.api.addOrder(address_id, total, function(response){
                console.log(response);
                location.assign('order.html');
            });
        });

        //点击新增按钮显示新增表单
        $("#addUserAddress").click(function(){
            $(".layer").show();
        });
        $(".layer h2 span").click(function(){
            $(".layer").hide();
        });

        $('#add').click(function(){
            var data = $("form").serialize();
            console.log(data);
            shop.api.addUserAddress(data, function(response){
                console.log(response);
                if (response.code === 0) {
                    $('.layer').hide();
                    fetchUserAddress();
                }
            });
        });

        fetchUserAddress();
        function fetchUserAddress() {
            shop.api.fetchUserAddress(function(response) {
                var html = "";
                for (var i = 0; i < response.data.length; i++) {
                    var obj = response.data[i];
                    html += '<div class="address-item" data-id="'+obj.address_id+'">'+ obj.address_name +' ' + obj.city + ' ' + obj.province + ' ' + obj.district + ' ' + obj.address +' ' + obj.mobile + ' </div>';
                }
                $('#address').html(html);
            });
        }
    });
    console.log(total)
</script>
</body>
</html>
